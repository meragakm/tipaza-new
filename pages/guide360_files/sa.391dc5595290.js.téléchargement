var sa_Entry=function(t){function e(e){for(var n,a,r=e[0],l=e[1],h=e[2],c=0,u=[];c<r.length;c++)a=r[c],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&u.push(o[a][0]),o[a]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);for(d&&d(e);u.length;)u.shift()();return s.push.apply(s,h||[]),i()}function i(){for(var t,e=0;e<s.length;e++){for(var i=s[e],n=!0,r=1;r<i.length;r++){var l=i[r];0!==o[l]&&(n=!1)}n&&(s.splice(e--,1),t=a(a.s=i[0]))}return t}var n={},o={5:0},s=[];function a(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=t,a.c=n,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(i,n,function(e){return t[e]}.bind(null,n));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="static/frontend/dist";var r=window.webpackJsonp_name_Entry=window.webpackJsonp_name_Entry||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var h=0;h<r.length;h++)e(r[h]);var d=l;return s.push([806,0]),i()}({806:function(t,e,i){i(61),t.exports=i(807)},807:function(t,e,i){(function(e){i(73),i(60);var n=i(808),o=i(75);t.exports={uploadEmbedPage:function(t){var i=t.annotationKey,s=t.annotationsDate,a=t.annotationsDisplay,r=t.annotationsPanelControls,l=t.autoplayAnnotations,h=t.autoplayIntervalAnnotations,d=t.captionText,c=t.displayMode,u=t.fov,p=t.heading,v=t.hideCardboard,g=t.includeLinkedPlans,f=t.linkedPlans,m=t.openPlan,w=t.planUuid,C=t.highVolume,y=t.isVideo,P=t.loggedIn,b=t.logo,T=t.m360LandingURL,D=t.m360Logo,E=t.ownerAccountTier,A=t.panSpeed,S=t.pitch,M=t.sphere,V=t.showM360,I=t.targetURL,x=t.titlebar,L=t.vrURL,k=t.wheel,O=t.yOrientationInDegrees,F=t.customData1,R=t.customData2,_=t.customData3,U=t.uploadUuid,B=new n.BarcodeView({size:400});document.getElementById("print-info").appendChild(B.el),e(document).ready((function(){I!==T||V||(I="");try{o.set(o.IS_EMBED,!0),window.momento360View=new n.Momento360View({allowFullScreen:!0,annotationKey:i,annotationsDate:s,annotationsDisplay:a,annotationsPanelControls:r,autoplayAnnotations:l,autoplayIntervalAnnotations:h,caption:d,displayMode:c,fov:u,heading:p,hideCardboard:v,includeLinkedPlans:g,linkedPlans:f,openPlan:m,planUuid:w,isVideo:y,logo:b,m360Logo:D,ownerAccountTier:E,panSpeed:A,pitch:S,preview:null,showM360:V,sphere:M,targetURL:I,titlebar:x,wheel:k,yOrientation:O*(Math.PI/180),customData1:F,customData2:R,customData3:_,uploadUuid:U,markerContext:{uploadUuid:U},uploadClickHandler:function(){}}),e("#sa-target").append(window.momento360View.el),window.momento360View.initializeRenderer(),window.momento360View.listenTo(window.momento360View,n.events.VRTriggered,(function(){window.open(L,"_blank")})),window.momento360View.listenTo(window.momento360View,n.events.CardboardEffectRequested,(function(){console.log("cardboard",window.momento360View),!C&&P&&analytics.track("Enter VR Mode",{media_type:null===window.momento360View.contentView.video?"photo":"video",vr_device_type:"cardboard",is_embed:!0})})),1!=window.M360logged_in&&gtag("event","View Embed",{is_collection:!1})}catch(t){console.error("Error",t)}}))},embedConfirmPage:function(){e(document).ready((function(){e("#id_password").attr("placeholder","Password").focus()}))},collectionEmbedPage:function(t){var i=t.annotationKey,s=t.annotationsDate,a=t.annotationsDisplay,r=t.annotationsPanelControls,l=t.autoplayAnnotations,h=t.autoplayCollection,d=t.autoplayIntervalAnnotations,c=t.autoplayIntervalCollection,u=t.displayMode,p=t.fov,v=t.heading,g=t.hideCardboard,f=t.includeLinkedPlans,m=t.openPlan,w=t.planUuid,C=t.linkedPlans,y=t.highVolume,P=t.loggedIn,b=t.logo,T=t.m360LandingURL,D=t.m360Logo,E=t.ownerAccountTier,A=t.panSpeed,S=t.pitch,M=t.positionInfos,V=t.showM360,I=t.resetHeading,x=t.targetURL,L=t.titlebar,k=t.uploadKey,O=t.vrURL,F=t.wheel,R=t.yOrientationInDegrees,_=t.customData1,U=t.customData2,B=t.customData3,N=t.collectionUuid,$=new n.BarcodeView({size:400});document.getElementById("print-info").appendChild($.el),x!==T||V||(x=""),e(document).ready((function(){try{o.set(o.IS_EMBED,!0),o.set(o.IS_COLLECTION_EMBED,!0),window.momento360CollectionView=new n.Momento360CollectionView({allowFullScreen:!0,annotationKey:i,annotationsDate:s,annotationsDisplay:a,annotationsPanelControls:r,autoplayAnnotations:l,autoplayCollection:h,autoplayIntervalAnnotations:d,autoplayIntervalCollection:c,displayMode:u,heading:v,hideCardboard:g,includeLinkedPlans:f,linkedPlans:C,openPlan:m,planUuid:w,fade:fade,fov:p,logo:b,m360Logo:D,ownerAccountTier:E,panSpeed:A,pitch:S,positionInfos:M,preview:null,resetHeading:I,showM360:V,targetURL:x,titlebar:L,uploadKey:k,wheel:F,yOrientation:R*(Math.PI/180),customData1:_,customData2:U,customData3:B,collectionUuid:N}),o.set(o.COLLECTION_VIEW,window.momento360CollectionView),e("#sa-target").append(window.momento360CollectionView.el),window.momento360CollectionView.initializeRenderer(),window.momento360CollectionView.listenTo(window.momento360CollectionView,n.events.VRTriggered,(function(){window.open(O,"_blank")})),window.momento360CollectionView.listenTo(window.momento360CollectionView,n.events.CardboardEffectRequested,(function(){!y&&P&&analytics.track("Enter VR Mode",{media_type:null===window.momento360CollectionView.sphereView.contentView.video?"photo":"video",vr_device_type:"cardboard",is_embed:!0})})),1!=window.M360logged_in&&gtag("event","View Embed",{is_collection:!0})}catch(t){console.error("Error",t)}}))}}}).call(this,i(1))},808:function(t,e,i){(function(e,n){function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function a(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?s(Object(i),!0).forEach((function(e){r(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):s(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function r(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function l(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return h(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return h(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}i(60),i(809);var d=i(4),c=i(53),u=i(358),p=i(359),v=i(5),g=i(19),f=g.ANNOTATION_AUTOPLAY_INTERVAL,m=g.ANNOTATION_DISPLAY_MODE,w=g.ANNOTATION_MARKER_STATE,C=i(26),y=C.ANNOTATION_JUMP_TO_ANNOTATION,P=C.ANNOTATION_SELECTED,b=C.ANNOTATION_TOGGLE_ANNOTATION_MODE,T=C.ANNOTATION_TOGGLE_SLIDESHOW,D=C.HOTSPOT_CLOSE_PANEL,E=C.ANNOTATION_OPEN_VIEW_PANEL,A=i(23),S=A.cartesianToLatLonDegree,M=A.findAnchorScreenPosition,V=A.getMarkerDataForState,I=A.latLonDegreeToCartesian,x=A.loadMarkerResourcesAsync,L=i(85),k=i(115),O=i(361),F=i(362),R=i(378),_=i(383),U=i(87),B=i(170),N=i(38),$=i(36),z=i(168).COLLECTION_AUTOPLAY_INTERVAL,q=i(817),j=q.isCleanDisplayModeAndPaid,H=q.isCleanDisplayModeAndPro,W=q.isCleanLogoDisplayModeAndPro,Y=q.isMlsDisplayModeAndPro,K=q.isMpDisplayMode,X=q.canDisplayCustomDataFields,G={events:{}};G.events.CardboardEffectRequested="momento360-cardboard-effect-requested",G.events.CardboardEffectStarted="momento360-cardboard-effect-started",G.events.CardboardEffectStopped="momento360-cardboard-effect-stopped",G.events.EnteredFullScreen="momento360-entered-full-screen",G.events.ExitedFullScreen="momento360-exited-full-screen",G.events.SphereViewMouseDown="momento360-sphere-view-mouse-down",G.events.VRTriggered="momento360-vr-triggered",G.TransitionTime=800,G.textureLoader=new c.TextureLoader,G.textureLoader.crossOrigin="anonymous",G.Momento360CollectionView=d.View.extend({className:"momento-360-collection-view",events:{"click .next":"showNext","click .previous":"showPrevious"},collectionViewHasUpload:function(t){return!!this.options.positionInfos.find((function(e){return e.uuid===t}))},navigateToUpload:function(t){var e=this.options.positionInfos.findIndex((function(e){return e.uuid===t}));if(e<0)console.warn("Collection view has no upload with uuid ".concat(t));else{this.setPosition(e);try{var i=new URL(location.href);i.searchParams.set("upload-key",t),history.replaceState(null,null,i.toString())}catch(t){console.error("Error",t)}}},initialize:function(t){var i=this;if(v.bindAll(this,"handleClick"),void 0!==t.positionInfos&&0!==t.positionInfos.length){void 0===t.autoplayAnnotations&&(t.autoplayAnnotations=!1),void 0===t.autoplayCollection&&(t.autoplayCollection=!1),void 0===t.autoplayIntervalAnnotations&&(t.autoplayIntervalAnnotations=f),void 0===t.autoplayIntervalCollection&&(t.autoplayIntervalCollection=z),void 0===t.hideCardboard&&(t.hideCardboard=!1),t.includeLinkedPlans=!0===t.includeLinkedPlans,t.linkedPlans=t.linkedPlans&&Array.isArray(t.linkedPlans)?t.linkedPlans:[],t.openPlan=!0===t.openPlan,t.planUuid=t.planUuid||null,this.options=t,this.isCleanAndPaid=j({displayMode:t.displayMode,tier:t.ownerAccountTier}),this.isCleanLogoAndPro=W({displayMode:t.displayMode,tier:t.ownerAccountTier}),this.showingCardboard=!1,this.currentIndex=v.findIndex(this.options.positionInfos,(function(t){return t.uuid===i.options.uploadKey})),-1===this.currentIndex&&(this.currentIndex=0);var o=this.options.positionInfos[this.currentIndex],s={allowFullScreen:t.allowFullScreen,annotationKey:t.annotationKey,annotationsDate:t.annotationsDate,annotationsDisplay:t.annotationsDisplay,annotationsPanelControls:t.annotationsPanelControls,autoplayAnnotations:t.autoplayAnnotations,autoplayIntervalAnnotations:t.autoplayIntervalAnnotations,caption:o.caption,displayMode:t.displayMode,fov:t.fov,heading:t.heading,hideCardboard:t.hideCardboard,includeLinkedPlans:t.includeLinkedPlans,linkedPlans:t.linkedPlans,openPlan:t.openPlan,planUuid:t.planUuid,isVideo:o.isVideo,logo:t.logo,m360Logo:t.m360Logo,ownerAccountTier:t.ownerAccountTier,panSpeed:t.panSpeed,pitch:t.pitch,preview:t.preview,resetHeading:t.resetHeading,showM360:t.showM360,sphere:o.sphere,targetURL:t.targetURL,titlebar:t.titlebar,wheel:t.wheel,yOrientation:t.yOrientation,customData1:t.customData1,customData2:t.customData2,customData3:t.customData3,markerContext:{collectionUuid:t.collectionUuid},collectionUuid:t.collectionUuid,uploadClickHandler:function(t){this.navigateToUpload(t)}.bind(this),collectionView:this};this.sphereView=new G.Momento360View(s),this.el.appendChild(this.sphereView.el),this.previousEl=e.span({class:"previous icon icon-chevron-left-circle"}).appendTo(this.el),this.thumbnailsEl=e.div({class:"thumbnails"}).appendTo(this.el),this.thumbnailList=e.table().appendTo(this.thumbnailsEl),this.thumbnailRow=e.tr().appendTo(this.thumbnailList);for(var a=0;a<this.options.positionInfos.length;a++){var r=e.td().appendTo(this.thumbnailRow);r.setAttribute("data-placement","top"),r.setAttribute("data-toggle","tooltip"),r.setAttribute("title",this.options.positionInfos[a].caption),document.body.clientWidth>$.views.GridBreakpoints.md&&n(r).tooltip({boundary:"window"});var l=e.img({src:this.options.positionInfos[a].thumbnail}).appendTo(r);n(l).on("click",function(){this.view.navigateToUpload(this.uploadUuid)}.bind({view:this,uploadUuid:this.options.positionInfos[a].uuid}))}this.nextEl=e.span({class:"next icon icon-chevron-right-circle"}).appendTo(this.el),this.updateArrows(),this.updateThumbnailSelection(),(this.isCleanAndPaid||this.isCleanLogoAndPro)&&this.hideControls(),t.autoplayCollection&&this.startAutoplayCollectionTimer(),this.listenTo(this.sphereView,G.events.CardboardEffectRequested,function(){this.hideControls(),this.trigger(G.events.CardboardEffectRequested)}.bind(this)),this.listenTo(this.sphereView,G.events.CardboardEffectStarted,function(){this.showingCardboard=!0,this.hideControls(),setTimeout(function(){this.el.addEventListener("touchstart",this.handleClick,!1)}.bind(this),500)}.bind(this)),this.listenTo(this.sphereView,G.events.CardboardEffectStopped,function(){this.showingCardboard=!1,this.showControls(),this.el.removeEventListener("touchstart",this.handleClick)}.bind(this)),this.listenTo(this.sphereView,G.events.VRTriggered,function(){this.trigger(G.events.VRTriggered)}.bind(this)),this.listenTo(this.sphereView,G.events.SphereViewMouseDown,function(){this.stopAutoplayCollectionTimer()}.bind(this)),setTimeout(this.scrollSelectedThumbnailIntoView.bind(this),100)}else console.error("Collection view needs at least one position info")},startAutoplayCollectionTimer:function(){this.autoplayCollectionTimer=setInterval(function(){var t=this.currentIndex<this.options.positionInfos.length-1?this.currentIndex+1:0;this.setPosition(t)}.bind(this),1e3*this.options.autoplayIntervalCollection)},stopAutoplayCollectionTimer:function(){clearInterval(this.autoplayCollectionTimer)},handleClick:function(t){return t.preventDefault(),!1===this.showingCardboard||(t.clientX>.33*this.$el.width()?this.showNext():this.showPrevious()),!1},hideControls:function(){n(this.previousEl).hide(),n(this.thumbnailsEl).hide(),n(this.nextEl).hide()},showControls:function(){this.isCleanAndPaid||this.isCleanLogoAndPro||(n(this.thumbnailsEl).show(),this.updateArrows(),this.updateThumbnailSelection())},updateArrows:function(){this.isCleanAndPaid||this.isCleanLogoAndPro||(n(this.previousEl).toggle(this.currentIndex>0),n(this.nextEl).toggle(this.currentIndex<this.options.positionInfos.length-1))},scrollSelectedThumbnailIntoView:function(){var t=n(this.thumbnailRow),e=t.find("td.selected").first(),i=e.position(),o=e.width(),s=t.parents(".thumbnails").first(),a=s.position(),r=s.width(),l=a.left+(i.left-Math.round(r/2)-Math.round((r-o)/2));s.animate({scrollLeft:l},800)},updateThumbnailSelection:function(){for(var t=0;t<this.thumbnailRow.children.length;t++){n(this.thumbnailRow.children.item(t)).toggleClass("selected",t===this.currentIndex)}this.scrollSelectedThumbnailIntoView()},showNext:function(){this.changePosition(1),!window.M360high_volume&&window.M360logged_in?analytics.track("embed view next",{"collection size":this.options.positionInfos.length}):window.M360high_volume||window.M360logged_in||"undefined"!=typeof amplitude&&amplitude.getInstance().logEvent("embed view next",{"collection size":this.options.positionInfos.length})},showPrevious:function(){this.changePosition(-1),!window.M360high_volume&&window.M360logged_in?analytics.track("embed view prev",{"collection size":this.options.positionInfos.length}):window.M360high_volume||window.M360logged_in||"undefined"!=typeof amplitude&&amplitude.getInstance().logEvent("embed view prev",{"collection size":this.options.positionInfos.length})},changePosition:function(t){if(0!==t){var e=this.currentIndex+t;if(!1===this.showingCardboard){if(t>0){if(e>=this.options.positionInfos.length)return}else if(e<0)return;this.setPosition(e)}else t>0?e>=this.options.positionInfos.length&&(e=0):e<0&&(e=this.options.positionInfos.length-1),this.setPosition(e)}},setPosition:function(t){if(t!==this.currentIndex){var e=this;e.currentIndex=t,this.sphereView.contentView.hotspotPanel.isVisible&&this.sphereView.contentView.hotspotPanel.close();var i=400;void 0!==e.options.fade&&(i=e.options.fade),n(".gl-container").fadeOut(i,(function(){if(e.options.resetHeading){var i=e.options.positionInfos[t];e.sphereView.resetFov(i.fov),e.sphereView.resetHeading(i.heading),e.sphereView.resetPitch(i.pitch)}e.sphereView.setContent(e.options.positionInfos[t].sphere,e.options.positionInfos[t].isVideo),e.sphereView.setCaptionText(e.options.positionInfos[t].caption),!1===e.showingCardboard&&(e.updateArrows(),e.updateThumbnailSelection())}))}},initializeRenderer:function(){this.sphereView.initializeRenderer()}}),G.BarcodeView=d.View.extend({className:"momento-barcode-view",initialize:function(t){(t=t||{}).size||(t.size=Math.min(document.body.clientWidth,document.body.clientHeight)-400,t.size<300&&(t.size=300)),this.closeEl=e.span({class:"barcode-close"},e.span({class:"icon icon-circle-fill backing-circle"}),e.span({class:"icon icon-close-circle"})).appendTo(this.el),this.barcodeEl=e.div({class:"barcode"}).appendTo(this.el),barcodeCopy="'q' key shows/hides QR code",this.barcodeText=e.p({class:"barcode-text"},barcodeCopy).appendTo(this.el);try{this.matrixBarcode=new MatrixBarcode(this.barcodeEl,{width:t.size,height:t.size,text:document.location.href})}catch(t){console.error("Error creating barcode",t),this.matrixBarcode=null}}}),G.Momento360View=d.View.extend({className:"momento-360-view",events:{"click .close-button":"handleCloseRequest","click .full-screen-button":"handleFullScreenRequest","click .plan-button":"handlePlanButtonClick","click .plan-context-menu > ul > li > a":"handleLinkedPlanClick","click .info-button":"handleInfoToggleRequest","click .barcode-close":"toggleBarcodeModal","click .indexview-popover-button":"handleIndexViewPopoverRequest"},initialize:function(t){if(v.bindAll(this,"handleCloseRequest","handleFullScreenRequest","handleIndexViewPopoverRequest","handlePlanButtonClick","handleLinkedPlanClick","handleInfoToggleRequest","onKeyPress","onFullScreenChange"),!t.sphere)throw"Requires a sphere option";if(!t.markerContext)throw new Error("Momento360View requires option markerContext");void 0===t.allowFullScreen&&(t.allowFullScreen=!0),void 0===t.autoplayAnnotations&&(t.autoplayAnnotations=!1),void 0===t.autoplayIntervalAnnotations&&(t.autoplayIntervalAnnotations=f),void 0===t.panSpeed&&(t.panSpeed=0),void 0===t.yOrientation&&(t.yOrientation=Math.PI),void 0===t.isVideo&&(t.isVideo=!1),void 0===t.logo&&(t.logo=null),void 0===t.hideCardboard&&(t.hideCardboard=!1),t.includeLinkedPlans=!0===t.includeLinkedPlans,t.linkedPlans=t.linkedPlans&&Array.isArray(t.linkedPlans)?t.linkedPlans:[],t.openPlan=!0===t.openPlan,t.planUuid=t.planUuid||null,this.options=t,this.contentView=null,this.isDisplayingInfoBar=t.titlebar,this.logoEl=null,this.logoAnchor=null,this.showingBarcodeModal=!1,this.wasFullScreen=!1,this.isCleanAndPaid=j({displayMode:t.displayMode,tier:t.ownerAccountTier}),this.isCleanAndPro=H({displayMode:t.displayMode,tier:t.ownerAccountTier}),this.isCleanLogoAndPro=W({displayMode:t.displayMode,tier:t.ownerAccountTier}),this.isMlsAndPro=Y({displayMode:t.displayMode,tier:t.ownerAccountTier}),this.isMp=K({displayMode:t.displayMode}),!1===t.allowFullScreen&&this.$el.addClass("disallow-full-screen"),this.barcodeView=new G.BarcodeView,this.barcodeView.$el.hide(),this.el.appendChild(this.barcodeView.el),document.addEventListener("keypress",this.onKeyPress,!1),document.addEventListener("fullscreenchange",this.onFullScreenChange,!1)},onFullScreenChange:function(t){G.isFullscreenMode()?(this.$el.addClass("full-screen"),this.contentView.$el.addClass("full-screen")):(this.$el.removeClass("full-screen"),this.contentView.$el.removeClass("full-screen"))},initializeRenderer:function(){var t;(this.contentView=new G.SphericalContentView({allowFullScreen:this.options.allowFullScreen,annotationKey:this.options.annotationKey,annotationsDate:this.options.annotationsDate,annotationsDisplay:this.options.annotationsDisplay,annotationsPanelControls:this.options.annotationsPanelControls,autoplayAnnotations:this.options.autoplayAnnotations,autoplayIntervalAnnotations:this.options.autoplayIntervalAnnotations,caption:this.options.caption,displayMode:this.options.displayMode,fov:this.options.fov,heading:this.options.heading,hideCardboard:this.options.hideCardboard,includeLinkedPlans:this.options.includeLinkedPlans,isVideo:this.options.isVideo,ownerAccountTier:this.options.ownerAccountTier,panSpeed:this.options.panSpeed,parent:this,pitch:this.options.pitch,preview:this.options.preview,sphere:this.options.sphere,wheel:this.options.wheel,yOrientation:this.options.yOrientation,customData:{customData1:this.options.customData1,customData2:this.options.customData2,customData3:this.options.customData3},markerContext:this.options.markerContext}),this.el.appendChild(this.contentView.el),this.contentView.initializeGL(),this.contentView.resizeCanvas(),null!=this.options.logo&&(this.logoEl=e.img({class:"logo",src:this.options.logo,alt:"logo"}),this.logoAnchor=e.a({class:"logo-anchor",href:this.options.targetURL,target:"_blank"},this.logoEl).appendTo(this.el),(!this.options.showM360&&this.options.logo===this.options.m360Logo||this.isMlsAndPro||this.isCleanAndPro)&&n(".logo-anchor").hide()),this.captionEl=e.div({class:"caption-text"},e.span({class:"caption-span"},this.options.caption)).appendTo(this.el),this.isCleanAndPaid||this.isCleanLogoAndPro?this.setInfoBarDisplay(!1):this.setInfoBarDisplay(this.isDisplayingInfoBar),this.options.includeLinkedPlans&&this.options.linkedPlans.length>0)&&(this.linkedPlansControlEl=e.div({class:"plan-button"},e.span({class:"icon icon-circle-fill backing-circle"}),e.span({class:"icon icon-floorplan-circle"})).appendTo(this.el),this.options.linkedPlans.length>1&&(this.linkedPlansContextMenuEl=e.div({class:"plan-context-menu d-none"},e.h4("Select the plan to display:"),(t=e).ul.apply(t,l(this.options.linkedPlans.map((function(t){return e.li(e.a(a(a(a({"data-uuid":t.uuid},"selectedPlanSheetUuid"in t?{"data-selected-plan-sheet-uuid":t.selectedPlanSheetUuid}:{}),"selectedPlanSheetTargetUuid"in t?{"data-selected-plan-sheet-target-uuid":t.selectedPlanSheetTargetUuid}:{}),{},{href:"#"}),t.name))}))))).appendTo(this.el)));this.infoControlEl=e.div({class:"info-button"},e.span({class:"icon icon-circle-fill backing-circle"}),e.span({class:"icon icon-info-button"})).appendTo(this.el),(this.isMp||this.isCleanAndPaid||this.isCleanLogoAndPro)&&this.hideInfoButton(),this.listenTo(this.contentView,G.events.CardboardEffectRequested,function(){this.logoAnchor&&n(this.logoAnchor).hide(),this.hideInfoButton(),this.hidePlanButton(),this.handleFullScreenRequest(),this.trigger(G.events.CardboardEffectRequested)}.bind(this)),this.listenTo(this.contentView,G.events.CardboardEffectStarted,function(){this.logoAnchor&&n(this.logoAnchor).hide(),this.hideInfoButton(),this.hidePlanButton(),this.hideCaption(),this.handleFullScreenRequest(),this.trigger(G.events.CardboardEffectStarted)}.bind(this)),this.listenTo(this.contentView,G.events.CardboardEffectStopped,function(){this.logoAnchor&&n(this.logoAnchor).show(),this.isDisplayingInfoBar&&this.showCaption(),this.showInfoButton(),this.showPlanButton(),this.trigger(G.events.CardboardEffectStopped)}.bind(this)),this.listenTo(this.contentView,G.events.VRTriggered,function(){this.trigger(G.events.VRTriggered)}.bind(this)),this.listenTo(this.contentView,G.events.SphereViewMouseDown,function(){this.trigger(G.events.SphereViewMouseDown)}.bind(this)),this.openLinkedPlanWithEmbedOptions()},remove:function(){d.View.prototype.remove.call(this),this.contentView&&this.contentView.remove(),document.removeEventListener("keypress",this.onKeyPress,!1)},resetFov:function(t){this.contentView.resetFov(t)},resetHeading:function(t){this.contentView.resetHeading(t)},resetPitch:function(t){this.contentView.resetPitch(t)},setContent:function(t,e){this.contentView.setContent(t,e)},setCaptionText:function(t){n(this.captionEl).children(".caption-span").text(t)},toggleInfoBar:function(){this.setInfoBarDisplay(!this.isDisplayingInfoBar)},setInfoBarDisplay:function(t){t?this.showCaption():this.hideCaption(),this.isDisplayingInfoBar=t},hideCaption:function(){n(this.captionEl).hide()},showCaption:function(){this.isCleanAndPaid||this.isCleanLogoAndPro||n(this.captionEl).show()},showInfoButton:function(){this.isMp||this.isCleanAndPaid||this.isCleanLogoAndPro||n(this.infoControlEl).show()},hideInfoButton:function(){n(this.infoControlEl).hide()},showPlanButton:function(){this.options.includeLinkedPlans&&this.options.linkedPlans.length>0&&n(this.linkedPlansControlEl).show()},hidePlanButton:function(){n(this.linkedPlansControlEl).hide()},saveFullScreenState:function(){this.wasFullScreen=this.$el.hasClass("full-screen")},restoreFullScreenState:function(){var t=this.$el.hasClass("full-screen");t&&!this.wasFullScreen?this.handleCloseRequest():!t&&this.wasFullScreen&&this.handleFullScreenRequest()},handleFullScreenRequest:function(t){this.isMp?window.open(document.location.href.replace("display-mode=mp","display-mode=mp_click"),"_blank").focus():this.contentView.promptForDeviceOrientationPermission(function(){t&&t.preventDefault(),!1!==this.options.allowFullScreen&&(G.requestFullScreen(),this.$el.addClass("full-screen"),this.contentView.$el.addClass("full-screen"),this.contentView.receivedOrientationEvent&&G.isMobile.any()&&this.contentView.orientationControls.connect(),this.contentView.shouldPan=!1,this.trigger(G.events.EnteredFullScreen,this))}.bind(this))},handleCloseRequest:function(){this.contentView&&this.contentView.showCardboardEffect&&this.contentView.exitCardboardEffect(),G.exitFullScreen(),this.trigger(G.events.ExitedFullScreen,this),this.$el.removeClass("full-screen"),this.contentView.$el.removeClass("full-screen"),this.contentView.orientationControls.disconnect()},handleIndexViewPopoverRequest:function(t){t&&t.preventDefault(),this.contentView&&"function"==typeof this.contentView.handleIndexViewPopoverRequest&&this.contentView.handleIndexViewPopoverRequest()},openLinkedPlan:function(t,e){var i=this,n=t.uuid,o=t.selectedPlanSheetUuid,s=t.selectedPlanSheetTargetUuid;new U({uuid:n},{context:this.options.markerContext}).fetchPromise().then((function(t){var n={};if(i.options.collectionUuid){var r=new N.models.UploadCollection({uuid:i.options.collectionUuid});n={uploadCollection:r}}else if(i.options.uploadUuid){var l=new N.models.Upload({uuid:i.options.uploadUuid});n={upload:l}}o&&(n.selectedPlanSheetUuid=o),s&&(n.selectedPlanSheetTargetUuid=s),(e?t.getTargetContextForUpload(e).then((function(t){return(t=t||{}).has("plan_sheet_uuid")&&(n.selectedPlanSheetUuid=t.get("plan_sheet_uuid")),t.has("plan_sheet_target_uuid")&&(n.selectedPlanSheetTargetUuid=t.get("plan_sheet_target_uuid")),n})):Promise.resolve(n)).then((function(e){new B(a(a({model:t,title:t.get("name"),allowEditing:!1,allowNewPlacements:!1},e),{},{uploadClickHandler:i.options.uploadClickHandler,openMarkerPanelOnClick:!1,hideButtonBar:!0,hidePlanTitle:!0,standAlonePlayer:!0})).open()}))}))},getCollectionContextUploadUuid:function(){var t=null;if(this.options.collectionView){var e=this.options.collectionView.options.positionInfos[this.options.collectionView.currentIndex];e&&e.uuid&&(t=e.uuid)}return t},handleLinkedPlanClick:function(t){t.preventDefault();var e=this.getCollectionContextUploadUuid();n(this.linkedPlansContextMenuEl).addClass("d-none");var i=n(t.currentTarget).data();this.openLinkedPlan(i,e)},handlePlanButtonClick:function(t){if(t.preventDefault(),this.options.linkedPlans.length>1)n(this.linkedPlansContextMenuEl).toggleClass("d-none");else if(1===this.options.linkedPlans.length){var e=this.getCollectionContextUploadUuid();this.openLinkedPlan(this.options.linkedPlans[0],e)}},openLinkedPlanWithEmbedOptions:function(){var t=this;if(this.options.openPlan&&!(this.options.linkedPlans.length<1)){var e=this.options.linkedPlans.find((function(e){return e.uuid===t.options.planUuid}))||this.options.linkedPlans[0],i=this.getCollectionContextUploadUuid();this.openLinkedPlan(e,i)}},handleInfoToggleRequest:function(){this.toggleInfoBar()},onKeyPress:function(t){113===t.charCode&&this.toggleBarcodeModal()},toggleBarcodeModal:function(){this.showingBarcodeModal?this.barcodeView.$el.hide():(this.barcodeView.$el.show(),!window.M360high_volume&&window.M360logged_in?analytics.track("Display QR Code"):window.M360high_volume||window.M360logged_in||"undefined"!=typeof amplitude&&amplitude.getInstance().logEvent("Display QR Code")),this.showingBarcodeModal=!this.showingBarcodeModal}}),function(t){t.Spring=function(e){var i=arguments;"object"!=o(e)&&(e={initial:i.length&&"number"==typeof i[0]?i[0]:void 0,springStiffness:i.length>1?i[1].springStiffness:5,animationTime:i.length>1?i[1].animationTime:1.5}),e.exponential&&(this._exponential=!0,delete e.exponential),t.extend(!0,this,e),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:t.now()},this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},t.Spring.prototype={resetTo:function(e){this.start.value=this.target.value=this.current.value=e,this.start.time=this.target.time=this.current.time=t.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(t){this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=t,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(t){this.start.value+=t,this.target.value+=t,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(t){this._exponential=t,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){var e,i;this.current.time=t.now(),this._exponential?(e=this.start._logValue,i=this.target._logValue):(e=this.start.value,i=this.target.value);var n,o,s=this.current.time>=this.target.time?i:e+(i-e)*(n=this.springStiffness,o=(this.current.time-this.start.time)/(this.target.time-this.start.time),(1-Math.exp(n*-o))/(1-Math.exp(-n))),a=this.current.value;return this._exponential?this.current.value=Math.exp(s):this.current.value=s,a!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}}}(n),G.SphericalContentView=d.View.extend({className:"momento-spherical-content-view",events:{"click .cardboard-toggle":"handleCardboardToggleClick","click .play-icon":"handlePlayIconClick","click .vr-trigger":"handleVRTrigger","click .rotate-cancel-button":"handleRotateCancelRequest"},initialize:function(t){if(v.bindAll(this,"animate","exitCardboardEffect","handleCardboardToggleClick","handlePlayIconClick","handleStillTextureError","handleStillTextureLoaded","handleVRTrigger","handleVideoAbort","handleVideoCanPlay","handleVideoCanPlayThrough","handleVideoEnded","handleVideoError","handleVideoLoadStart","handleVideoLoadedData","handleVideoLoadedMetadata","handleVideoPause","handleVideoPlay","handleVideoPlaying","handleVideoStalled","handleVideoTimeUpdate","handleVideoWaiting","initializeGL","onClick","onDblClick","onDeviceOrientationChange","onDocumentDragOver","onDocumentMouseDown","onDocumentMouseMove","onDocumentMouseOut","onDocumentMouseUp","onFirstDeviceOrientationChange","onTouchEnd","onTouchMove","onTouchStart","onWheel","onWindowResize","remove","resizeCanvas","stopInteracting","transitionAwayFromPreview"),!t.sphere)throw"Requires a sphere option";if(!t.markerContext)throw new Error("SphericalContentView requires option markerContext");void 0===t.allowFullScreen&&(t.allowFullScreen=!0),void 0===t.annotationsDate&&(t.annotationsDate=!0),void 0===t.annotationsDisplay&&(t.annotationsDisplay=!0),void 0===t.annotationsPanelControls&&(t.annotationsPanelControls=!0),void 0===t.autoplayAnnotations&&(t.autoplayAnnotations=!1),void 0===t.autoplayIntervalAnnotations&&(t.autoplayIntervalAnnotations=f),void 0===t.isVideo&&(t.isVideo=!1),void 0===t.panSpeed&&(t.panSpeed=0),void 0===t.yOrientation&&(t.yOrientation=Math.PI),void 0===t.hideCardboard&&(t.hideCardboard=!1),void 0===t.heading&&(t.heading=0),void 0===t.pitch&&(t.pitch=0),void 0===t.fov&&(t.fov=75),this.options=t,this.cleanedUp=!1,this.animating=!1,this.shouldPan=!0,this.clock=null,this.camera=null,this.scene=null,this.renderer=null,this.raycaster=null,this.currentTargetAnnotationIdx=-1,this.playSlideshow=!1,this.effect=null,this.orientationControls=null,this.video=null,this.videoImage=null,this.videoImageContext=null,this.mesh=null,this.sphereGeometry=new c.SphereGeometry(500,60,40),this.sphereGeometry.scale(-1,1,1),this.showCardboardEffect=!1,this.waitingForCardboardRotation=!1,this.receivedOrientationEvent=!1,this.isUserInteracting=!1,this.annotationDisplayMode=t.annotationsDisplay?m.MARKER_AND_UI:m.HIDDEN,this.isCleanAndPaid=j({displayMode:t.displayMode,tier:t.ownerAccountTier}),this.isCleanLogoAndPro=W({displayMode:t.displayMode,tier:t.ownerAccountTier}),this.isMp=K({displayMode:t.displayMode}),this.useCustomDataFields=X({tier:t.ownerAccountTier}),this.onMouseDownMouseX=0,this.onMouseDownMouseY=0,this.lon=this.options.heading,this.lonSpring=new n.Spring({animationTime:.7,exponential:!1,initial:this.lon,springStiffness:5.5}),this.lat=this.options.pitch,this.latSpring=new n.Spring({animationTime:.7,exponential:!1,initial:this.lat,springStiffness:5.5}),this.defaultFov=75,this.minFov=20,this.maxFov=100,this.fov=t.fov,this.fovSpring=new n.Spring({animationTime:.7,exponential:!1,initial:this.fov,springStiffness:5.5}),this.onMouseDownLon=0,this.onMouseDownLat=0,this.phi=0,this.theta=0,this.isInPortraitOrientation=G.isInPortraitOrientation(),this.setOrientationClasses(),this.previewEl=e.div({class:"preview"}).appendTo(this.el),this.options.preview?(this.previewImage=new Image,this.previewImage.crossOrigin="anonymous",this.previewImage.src=this.options.preview,this.previewEl.appendChild(this.previewImage)):n(this.previewEl).addClass("no-preview"),this.glContainer=e.div({class:"gl-container"}).appendTo(this.el),n(this.glContainer).hide(),this.rotateScreenIcon=e.div({class:"rotate-screen-icon"},e.div({class:"icons"},e.span({class:"icon icon-rotate-new"}),e.span({class:"icon icon-arrow-right"}),e.span({class:"icon icon-cardboard-device"})),e.br(),e.span("ROTATE AND INSERT INTO CARDBOARD"),e.br(),e.br(),e.a({class:"rotate-cancel-button",href:"#"},"Click here to cancel")).appendTo(this.el),this.stillSpinnerIcon=e.div({class:"still-spinner-icon"},e.span({class:"icon icon-spinner icon-spin"})).appendTo(this.el),n(this.stillSpinnerIcon).hide(),this.stillErrorIcon=e.div({class:"still-error-icon"},e.span({class:"icon icon-exclamation-circle"})).appendTo(this.el),n(this.stillErrorIcon).hide(),this.videoControls=e.div({class:"video-controls"}).appendTo(this.el),this.$videoControls=n(this.videoControls),this.$videoControls.hide(),this.playIcon=e.div({class:"play-icon "},e.span({class:"icon icon-circle-fill backing-circle"}),e.span({class:"icon icon-play-circle"})).appendTo(this.videoControls),this.spinnerIcon=e.div({class:"spinner-icon"},e.span({class:"icon icon-spinner icon-spin"})).appendTo(this.videoControls),n(this.spinnerIcon).hide(),this.errorIcon=e.div({class:"error-icon icon icon-exclamation-circle"}).appendTo(this.videoControls),n(this.errorIcon).hide(),this.rightButtonWrapper=e.div({class:"right-button-wrapper"}).appendTo(this.el),this.indexViewPopoverButton=e.div({class:"indexview-popover-button"},e.span({class:"icon icon-circle-fill backing-circle"}),e.span({class:"icon icon-vertical-ellipsis-circle"})).appendTo(this.el),(this.isCleanAndPaid||this.isCleanLogoAndPro)&&n(this.indexViewPopoverButton).hide(),this.closeButton=e.div({class:"close-button"},e.span({class:"icon icon-circle-fill backing-circle"}),e.span({class:"icon icon-close-circle"})).appendTo(this.rightButtonWrapper),this.fullScreenButton=e.div({class:"full-screen-button"},e.span({class:"icon icon-circle-fill backing-circle"}),e.span({class:"icon icon-full-screen-circle"})).appendTo(this.rightButtonWrapper),(this.isCleanAndPaid||this.isCleanLogoAndPro)&&n(this.fullScreenButton).hide(),this.cardboardToggle=e.div({class:"cardboard-toggle"},e.span({class:"icon icon-circle-fill backing-circle"}),e.span({class:"icon icon-cardboard-circle"})).appendTo(this.rightButtonWrapper),(this.options.hideCardboard||this.isMp||this.isCleanAndPaid||this.isCleanLogoAndPro)&&n(this.cardboardToggle).hide(),this.vrTrigger=e.div({class:"vr-trigger"},e.span({class:"icon icon-circle-fill backing-circle"}),e.span({class:"icon icon-vr"})).appendTo(this.rightButtonWrapper),n(this.vrTrigger).hide(),this.glContainer.addEventListener("mousedown",this.onDocumentMouseDown,!1),this.glContainer.addEventListener("mousemove",this.onDocumentMouseMove,!1),this.glContainer.addEventListener("mouseup",this.onDocumentMouseUp,!1),this.glContainer.addEventListener("mouseout",this.onDocumentMouseOut,!1),this.glContainer.addEventListener("dragover",this.onDocumentDragOver,!1),this.glContainer.addEventListener("touchend",this.onTouchEnd,!1),this.glContainer.addEventListener("touchmove",this.onTouchMove,!1),this.glContainer.addEventListener("touchstart",this.onTouchStart,!1),this.glContainer.addEventListener("wheel",this.onWheel,!1),this.glContainer.addEventListener("dblclick",this.onDblClick,!1),this.glContainer.addEventListener("click",this.onClick,!1),window.addEventListener("resize",this.onWindowResize,!1),window.addEventListener("deviceorientation",this.onFirstDeviceOrientationChange,!1),"function"==typeof navigator.getVRDisplays&&navigator.getVRDisplays().then(function(t){for(var e=0;e<t.length;e++)if(t[e].capabilities.canPresent){this.isMp||this.isCleanAndPaid||this.isCleanLogoAndPro||n(this.vrTrigger).css("display","");break}}.bind(this))},promptForDeviceOrientationPermission:function(t){"undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(t).catch((function(e){console.error(e),t()})):t()},reloadAnnotations:function(t){var e=t.split("/"),i=e[e.length-2];this.annotations&&this.removeAllAnnotations(),this.annotations=[],this.stopSlideshow();var o=function(){this.idxView&&(this.idxView.remove(),this.idxView=null),this.annotationTargetCollection=new k({uuid:i});var t=function(t){var e=t.get("annotation"),i={heading:t.get("heading"),pitch:t.get("pitch"),text:e.get("title"),imageUrl:null,model:e,thumbnailUrl:t.get("thumbnail_url"),key:e.cid,state:w.NORMAL},n=e.get("media");return n.length>0&&(i.imageUrl=n.first().get("source_url")),i}.bind(this);this.annotationTargetCollection.fetch({error:function(t,e,i){console.error("Error")}.bind(this),success:function(t,e,i){if(""!==this.options.annotationKey)for(var o=0;o<this.annotationTargetCollection.models.length;++o){var s=this.annotationTargetCollection.models[o].get("annotation");s.get("uuid")===this.options.annotationKey&&(this.shouldPan=!1,this.jumpToAnnotationByKey(s.cid))}this.isCleanAndPaid||this.isCleanLogoAndPro||(0===this.annotationTargetCollection.models.length?n(this.indexViewPopoverButton).hide():n(this.indexViewPopoverButton).show()),this.options.autoplayAnnotations&&this.startSlideshow()}.bind(this)}),this.annotationTargetCollection.on("add",function(e){var i=t(e);this.updateAnnotationsInScene([i]),this.findAnnotationInScene(i.key)||this.annotations.push(i)}.bind(this)),this.annotationTargetCollection.on("remove",function(e){if(v.isObject(e.get("annotation"))){var i=t(e),n=this.findAnnotationInScene(i.key);n&&this.removeDeletedAnnotationsFromScene([n])}}.bind(this)),this.annotationTargetCollection.on("change:annotation_marker",function(t){var e=t.get("annotation").cid,i=this.findAnnotationInScene(e),n=V(this.annotationMarkerData,i.state,t);i.mesh&&(i.mesh.material=n.material)}.bind(this)),this.annotationPanel&&this.annotationPanel.remove(),this.annotationPanel=new F({annotationsDate:this.options.annotationsDate,annotationsPanelControls:this.options.annotationsPanelControls,annotationTargetCollection:this.annotationTargetCollection,readOnly:!0,standAlonePlayer:!0,useCustomDataFields:this.useCustomDataFields,customData:this.options.customData,uploadUuid:i}),this.hotspotPanel&&this.hotspotPanel.remove(),this.hotspotPanel=new _({annotationsDate:this.options.annotationsDate,annotationsPanelControls:this.options.annotationsPanelControls,annotationTargetCollection:this.annotationTargetCollection,mainAnnotationPanel:this.annotationPanel,readOnly:!1,useCustomDataFields:this.useCustomDataFields,customData:this.options.customData,history:this.options.history}),this.off(P).on(P,function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.get("annotation").get("annotation_type");this.annotationPanel.checkTypeAndSetVisibility(t)?(this.hotspotPanel.trigger(D),this.annotationPanel.trigger(E,t)):this.hotspotPanel.trigger(E,t,e),this.annotationPanel.userDidClickAnnotation=!1}.bind(this)),this.annotationPanel.on(y,function(t){this.jumpToAnnotationByKey(t.cid)}.bind(this)),this.$el.append(this.annotationPanel.el),this.$el.append(this.hotspotPanel.el),this.deselectAllAnnotationsForSidebar(!0)}.bind(this);this.annotationMarkerCollection=new L(null,{context:this.options.markerContext}),this.annotationMarkerData={},x(this.annotationMarkerCollection,G.textureLoader).then(function(t){this.annotationMarkerData=t,o()}.bind(this)).catch(function(t){console.error(t)}.bind(this))},initializeGL:function(){this.cleanedUp||(this.clock=new c.Clock,this.camera=new c.PerspectiveCamera(this.fov,this.$el.width()/this.$el.height(),1,1100),this.camera.target=new c.Vector3(0,0,0),this.orientationControls=new p(this.camera,!0),this.orientationControls.disconnect(),this.scene=new c.Scene,this.raycaster=new c.Raycaster,this.orientCamera(),this.renderer=new c.WebGLRenderer,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.$el.width(),this.$el.height()),this.glContainer.appendChild(this.renderer.domElement),this.effect=new u(this.renderer),this.effect.setSize(this.$el.width(),this.$el.height()),this.setContent(this.options.sphere,this.options.isVideo))},resetFov:function(t){this.fovSpring.springTo(t)},resetHeading:function(t){this.lonSpring.resetTo(t)},resetPitch:function(t){this.latSpring.resetTo(t)},setContent:function(t,e){this.cleanVideo(),e?(this.video=document.createElement("video"),this.video.crossOrigin="anonymous",this.video.src=t,this.video.addEventListener("loadstart",this.handleVideoLoadStart,!1),this.video.addEventListener("abort",this.handleVideoAbort,!1),this.video.addEventListener("error",this.handleVideoError,!1),this.video.addEventListener("stalled",this.handleVideoStalled,!1),this.video.addEventListener("loadedmetadata",this.handleVideoLoadedMetadata,!1),this.video.addEventListener("loadeddata",this.handleVideoLoadedData,!1),this.video.addEventListener("canplay",this.handleVideoCanPlay,!1),this.video.addEventListener("canplaythrough",this.handleVideoCanPlayThrough,!1),this.video.addEventListener("playing",this.handleVideoPlaying,!1),this.video.addEventListener("waiting",this.handleVideoWaiting,!1),this.video.addEventListener("play",this.handleVideoPlay,!1),this.video.addEventListener("timeupdate",this.handleVideoTimeUpdate,!1),this.video.addEventListener("pause",this.handleVideoPause,!1),this.video.addEventListener("ended",this.handleVideoEnded,!1),this.video.load()):(this.$videoControls.hide(),this.showStillSpinner(),this.reloadAnnotations(t),G.textureLoader.load(t,this.handleStillTextureLoaded,null,this.handleStillTextureError))},transitionAwayFromPreview:function(){var t=(new Date).getTime(),e=this;!function i(){if(null!=e.previewEl){if(null!=e.previewImage){(o=1-((new Date).getTime()-t)/G.TransitionTime)<=0?(n(e.previewImage).hide(),e.previewImage=null,t=(new Date).getTime()):n(e.previewImage).css("opacity",o)}else{var o;if((o=1-((new Date).getTime()-t)/G.TransitionTime)<=0)return n(e.previewEl).hide(),void(e.previewEl=null);n(e.previewEl).css("opacity",o)}setTimeout(i,1)}}()},cleanVideo:function(){null!==this.video&&(this.video.paused||this.video.pause(),this.video.removeEventListener("loadstart",this.handleVideoLoadStart,!1),this.video.removeEventListener("abort",this.handleVideoAbort,!1),this.video.removeEventListener("error",this.handleVideoError,!1),this.video.removeEventListener("stalled",this.handleVideoStalled,!1),this.video.removeEventListener("loadedmetadata",this.handleVideoLoadedMetadata,!1),this.video.removeEventListener("loadeddata",this.handleVideoLoadedData,!1),this.video.removeEventListener("canplay",this.handleVideoCanPlay,!1),this.video.removeEventListener("canplaythrough",this.handleVideoCanPlayThrough,!1),this.video.removeEventListener("playing",this.handleVideoPlaying,!1),this.video.removeEventListener("waiting",this.handleVideoWaiting,!1),this.video.removeEventListener("play",this.handleVideoPlay,!1),this.video.removeEventListener("timeupdate",this.handleVideoTimeUpdate,!1),this.video.removeEventListener("pause",this.handleVideoPause,!1),this.video.removeEventListener("ended",this.handleVideoEnded,!1),this.video=null,this.$videoControls.hide())},remove:function(){if(d.View.prototype.remove.call(this),this.cleanedUp=!0,this.removeAllAnnotations(),this.glContainer.removeEventListener("mousedown",this.onDocumentMouseDown,!1),this.glContainer.removeEventListener("mousemove",this.onDocumentMouseMove,!1),this.glContainer.removeEventListener("mouseup",this.onDocumentMouseUp,!1),this.glContainer.removeEventListener("mouseout",this.onDocumentMouseOut,!1),this.glContainer.removeEventListener("dragover",this.onDocumentDragOver,!1),this.glContainer.removeEventListener("touchend",this.onTouchEnd,!1),this.glContainer.removeEventListener("touchmove",this.onTouchMove,!1),this.glContainer.removeEventListener("touchstart",this.onTouchStart,!1),this.glContainer.removeEventListener("wheel",this.onWheel,!1),this.glContainer.removeEventListener("dblclick",this.onDblClick,!1),this.glContainer.removeEventListener("click",this.onClick,!1),window.removeEventListener("deviceorientation",this.onFirstDeviceOrientationChange,!1),window.removeEventListener("resize",this.onWindowResize,!1),this.cleanVideo(),this.mesh&&this.scene&&this.scene.remove(this.mesh),this.mesh&&(this.disposeThreeObject(this.mesh),this.mesh=null),this.sphereGeometry&&(this.sphereGeometry.dispose(),this.sphereGeometry=null),this.videoMaterial&&(this.videoMaterial.dispose(),this.videoMaterial=null),this.stillMaterial&&(this.stillMaterial.dispose(),this.stillMaterial=null),this.stillTexture&&(this.stillTexture.dispose(),this.stillTexture=null),this.scene&&(this.disposeThreeObject(this.scene),this.scene=null),this.renderer){var t=this.renderer.extensions.get("WEBGL_lose_context");t&&"function"==typeof t.loseContext?this.renderer.forceContextLoss():console.error("WEBGL_lose_context is not supported, so this texture will leak."),this.renderer.context=null,this.renderer.domElement=null,this.renderer=null}},disposeThreeObject:function(t,e){if(void 0===e&&(e=!1),null!==t){for(var i=0;i<t.children.length;i++)this.disposeThreeObject(t.children[i]);if(t.geometry&&(e||t.geometry.dispose(),t.geometry=void 0),t.material){if(t.material.materials)for(i=0;i<t.material.materials.length;i++)t.material.materials[i].dispose();t.material.dispose(),t.material=void 0}t.texture&&(t.texture.dispose(),t.texture=void 0)}t=void 0},handleVRTrigger:function(t){t&&t.preventDefault(),this.trigger(G.events.VRTriggered),navigator.getVRDisplays().then((function(t){for(var e=0;e<t.length;e++)if(t[e].capabilities.canPresent){!window.M360high_volume&&window.M360logged_in?analytics.track("webvr dialog triggered",{isEmbed:!0,"vr device":t[e].displayName||""}):window.M360high_volume||window.M360logged_in||"undefined"!=typeof amplitude&&amplitude.getInstance().logEvent("webvr dialog triggered",{isEmbed:!0,"vr device":t[e].displayName||""});break}}))},handleStillTextureLoaded:function(t){this.cleanedUp||(this.transitionAwayFromPreview(),this.hideStillSpinner(),null!=this.previewEl?n(this.glContainer).show():n(this.glContainer).fadeIn(400),t.generateMipmaps=!1,t.minFilter=c.LinearFilter,t.magFilter=c.LinearFilter,this.stillMaterial&&(this.stillMaterial.dispose(),this.stillMaterial=null),this.stillMaterial=new c.MeshBasicMaterial({map:t}),this.stillTexture&&(this.stillTexture.dispose(),this.stillTexture=null),this.stillTexture=t,this.initializeWithMaterial(this.stillMaterial))},handleStillTextureError:function(){console.error("Error loading still texture",arguments),this.showStillError()},initializeWithMaterial:function(t){this.cleanedUp||(null!==this.mesh&&(this.scene.remove(this.mesh),this.disposeThreeObject(this.mesh,!0),this.mesh=null),this.mesh=new c.Mesh(this.sphereGeometry,t),this.scene.add(this.mesh),this.mesh.rotateOnAxis(new c.Vector3(0,1,0),this.options.yOrientation),this.materialInitialized=!0,!1===this.animating&&(this.animate(),this.animating=!0))},showStillSpinner:function(){n(this.stillErrorIcon).hide(),n(this.stillSpinnerIcon).show()},hideStillSpinner:function(){n(this.stillErrorIcon).hide(),n(this.stillSpinnerIcon).hide()},showStillError:function(){n(this.stillErrorIcon).show(),n(this.stillSpinnerIcon).hide()},hideStillError:function(){n(this.stillErrorIcon).hide(),n(this.stillSpinnerIcon).hide()},showVideoSpinner:function(){n(this.playIcon).hide(),n(this.spinnerIcon).show(),n(this.errorIcon).hide()},showVideoPlay:function(){n(this.playIcon).show(),n(this.spinnerIcon).hide(),n(this.errorIcon).hide()},showVideoError:function(){n(this.playIcon).hide(),n(this.spinnerIcon).hide(),n(this.errorIcon).show()},handleVideoLoadStart:function(t){this.showVideoSpinner(),this.$videoControls.show()},handleVideoAbort:function(t){this.showVideoError(),this.$videoControls.show()},handleVideoError:function(t){this.showVideoError(),this.$videoControls.show()},handleVideoStalled:function(t){},handleVideoLoadedMetadata:function(t){this.cleanedUp||(this.transitionAwayFromPreview(),n(this.glContainer).show(),null===this.videoImageContext&&(this.videoImage=document.createElement("canvas"),this.videoImageContext=this.videoImage.getContext("2d"),this.videoImageContext.fillStyle="#000000",this.videoTexture=new c.Texture(this.videoImage),this.videoTexture.minFilter=c.LinearFilter,this.videoTexture.magFilter=c.LinearFilter,this.videoMaterial=new c.MeshBasicMaterial({map:this.videoTexture,overdraw:!0})),this.videoImage.width=this.video.videoWidth,this.videoImage.height=this.video.videoHeight,this.videoImageContext.fillRect(0,0,this.videoImage.width,this.videoImage.height),this.initializeWithMaterial(this.videoMaterial),this.$videoControls.show())},handleVideoLoadedData:function(t){},handleVideoCanPlay:function(t){this.video.paused&&(this.showVideoPlay(),this.$videoControls.show())},handleVideoCanPlayThrough:function(t){this.video.paused&&(this.showVideoPlay(),this.$videoControls.show())},handleVideoPlaying:function(t){this.showVideoSpinner(),this.$videoControls.show()},handleVideoTimeUpdate:function(t){this.video.paused||this.$videoControls.hide()},handleVideoWaiting:function(t){this.showVideoSpinner(),this.$videoControls.show()},handleVideoPlay:function(t){},handleVideoPause:function(t){this.showVideoPlay(),this.$videoControls.show()},handleVideoEnded:function(t){this.showVideoPlay(),this.$videoControls.show()},handlePlayIconClick:function(t){this.cleanedUp||(t&&t.preventDefault(),this.video&&(this.shouldPan=!1,this.video.play()))},handleRotateCancelRequest:function(t){t&&t.preventDefault(),this.waitingForCardboardRotation=!1,this.$el.removeClass("showing-cardboard waiting-for-cardboard-rotation"),this.trigger(G.events.CardboardEffectStopped),this.options.parent.restoreFullScreenState()},handleCardboardToggleClick:function(t){t&&t.preventDefault(),this.cleanedUp||(this.options.parent.saveFullScreenState(),this.trigger(G.events.CardboardEffectRequested),this.isInPortraitOrientation?(this.waitingForCardboardRotation=!0,this.$el.addClass("showing-cardboard waiting-for-cardboard-rotation")):this.enterCardboardEffect())},enterCardboardEffect:function(){n(this.cardboardToggle).hide(),this.showCardboardEffect=!0,this.$el.addClass("showing-cardboard"),this.$el.removeClass("waiting-for-cardboard-rotation"),this.orientationControls.connect(),this.resizeCanvas(),this.trigger(G.events.CardboardEffectStarted)},exitCardboardEffect:function(t){t&&t.preventDefault(),this.showCardboardEffect=!1,this.$el.removeClass("showing-cardboard"),this.resizeCanvas(),this.trigger(G.events.CardboardEffectStopped),this.showCardboardToggle()},onFirstDeviceOrientationChange:function(t){this.cleanedUp||(this.receivedOrientationEvent=!0,this.showCardboardToggle(),this.isInPortraitOrientation=G.isInPortraitOrientation(),this.setOrientationClasses(),this.resizeCanvas(),window.removeEventListener("deviceorientation",this.onFirstDeviceOrientationChange,!1),window.addEventListener("deviceorientation",this.onDeviceOrientationChange,!1))},showCardboardToggle:function(){this.isMp||this.isCleanAndPaid||this.isCleanLogoAndPro||n(this.cardboardToggle).css("display","")},onDeviceOrientationChange:function(t){this.cleanedUp||this.isInPortraitOrientation!=G.isInPortraitOrientation()&&(this.isInPortraitOrientation=!this.isInPortraitOrientation,this.setOrientationClasses(),this.waitingForCardboardRotation&&!1===this.isInPortraitOrientation?(this.waitingForCardboardRotation=!1,this.enterCardboardEffect()):this.isInPortraitOrientation&&this.showCardboardEffect&&this.exitCardboardEffect(),this.resizeCanvas())},setOrientationClasses:function(){this.isInPortraitOrientation?this.$el.addClass("portrait").removeClass("landscape"):this.$el.removeClass("portrait").addClass("landscape")},onWindowResize:function(){this.cleanedUp||this.resizeCanvas()},resizeCanvas:function(){this.cleanedUp||(this.camera.aspect=this.$el.width()/this.$el.height(),this.camera.updateProjectionMatrix(),this.renderer.setSize(this.$el.width(),this.$el.height()),this.effect.setSize(this.$el.width(),this.$el.height()))},getZoomFactor:function(){return this.fovSpring.current.value/this.defaultFov},hitTestAnnotation:function(t,e){var i=this.glContainer.getBoundingClientRect();if(t<i.left||e<i.top||t>i.left+i.width||e>i.top+i.height)return null;var n=t-i.left,o=e-i.top,s=this.$el.width(),a=this.$el.height(),r={};r.x=n/s*2-1,r.y=-o/a*2+1,this.raycaster.setFromCamera(r,this.camera);var l=this.raycaster.intersectObjects(this.scene.children),h=null;if(l&&l.length>0)for(var d=0;d<l.length;++d)for(var c=0;c<this.annotations.length;++c){var u=this.annotations[c];if(u.mesh===l[d].object){h=u,c;break}}return h},onClick:function(t){if(!this.cleanedUp&&!this.showCardboardEffect&&this.annotationDisplayMode===m.MARKER_AND_UI){var e=this.onPointerDownPointerX-t.clientX,i=this.onPointerDownPointerY-t.clientY;if(!(Math.sqrt(e*e+i*i)>3)){this.stopSlideshow(),t.preventDefault(),t.stopPropagation();var n=this.hitTestAnnotation(this.onPointerDownPointerX,this.onPointerDownPointerY);null!=n&&(this.annotationPanel.userDidClickAnnotation=!0,this.selectAnnotationForSidebar(n,!0))}}},markerDataForAnnotations:function(t){return t.model?V(this.annotationMarkerData,t.state,this.annotationTargetCollection.getTargetForAnnotation(t.model)):V(this.annotationMarkerData,t.state,null)},materialForAnnotation:function(t){return markerData=this.markerDataForAnnotations(t),markerData.material},deselectAllAnnotationsForSidebar:function(t){for(var e=0;e<this.annotations.length;++e){var i=this.annotations[e];i.state=w.NORMAL,i.mesh&&(i.mesh.material=this.materialForAnnotation(i),i.mesh.visible=t)}},selectAnnotationForSidebar:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];null===t&&console.error("unexpected null annotation"),this.annotationDisplayMode===m.HIDDEN?this.deselectAllAnnotationsForSidebar(!1):this.deselectAllAnnotationsForSidebar(!0),t.state=w.SELECTED,t.mesh&&(t.mesh.material=this.materialForAnnotation(t));var i=this.annotationTargetCollection.getTargetForAnnotation(t.model);this.trigger(P,i,e)},updateAnnotationHoverStateForSidebar:function(t){for(var e=0;e<this.annotations.length;++e){var i=this.annotations[e];i.mesh&&i.state===w.HOVER&&(i.state=w.NORMAL,i.mesh&&(i.mesh.material=this.materialForAnnotation(i)))}if(null!==t&&t.state!=w.SELECTED&&(t.state=w.HOVER),null!==t&&t.mesh&&t.state==w.HOVER&&(t.mesh.material=this.materialForAnnotation(t)),null===t||t.preview)null===t&&this.removeHoverStateOverlays();else if(this.removeHoverStateOverlays(),t.model){var o=new R({anchor:new c.Vector2(0,0),model:t.model,standAlonePlayer:this.annotationPanel.standAlonePlayer,useCustomDataFields:this.annotationPanel.useCustomDataFields,customData:this.annotationPanel.customData});n(o.$el).css({visibility:"hidden"}),n("body").append(o.$el);var s=o.$el.children().get(0).offsetHeight,a=o.$el.children().get(0).offsetWidth;n(o.$el).remove();var r=M(t.mesh,this.camera,n(this.glContainer).innerWidth(),n(this.glContainer).innerHeight(),a,s);t.preview=new R({anchor:r,model:t.model,standAlonePlayer:this.annotationPanel.standAlonePlayer,useCustomDataFields:this.annotationPanel.useCustomDataFields,customData:this.annotationPanel.customData}),t.preview.$el.appendTo(this.glContainer)}},onDblClick:function(t){if(!this.cleanedUp){for(var e=(this.defaultFov-this.minFov)/2,i=[[this.maxFov,this.defaultFov,this.defaultFov],[this.defaultFov,this.defaultFov-e,this.defaultFov-e],[this.defaultFov-e,this.defaultFov-2*e,this.defaultFov-2*e],[this.defaultFov-2*e,0,this.defaultFov]],n=0;n<i.length;++n)if(this.fov<=i[n][0]&&this.fov>i[n][1]){this.fov=i[n][2];break}this.fovSpring.springTo(this.fov)}},onWheel:function(t){if(!this.cleanedUp&&this.options.wheel){t.preventDefault();var e=function(t){var e=0,i=0,n=0,o=0;return"detail"in t&&(i=t.detail),"wheelDelta"in t&&(i=-t.wheelDelta/120),"wheelDeltaY"in t&&(i=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=i,i=0),n=10*e,o=10*i,"deltaY"in t&&(o=t.deltaY),"deltaX"in t&&(n=t.deltaX),(n||o)&&t.deltaMode&&(1==t.deltaMode?(n*=40,o*=40):(n*=800,o*=800)),n&&!e&&(e=n<1?-1:1),o&&!i&&(i=o<1?-1:1),{spinX:e,spinY:i,pixelX:n,pixelY:o}}(t);this.fov+=2*e.spinY,this.fovSpring.springTo(this.fov)}},onTouchStart:function(t){if(!this.cleanedUp)if(this.shouldPan=!1,0==this.showCardboardEffect&&this.orientationControls.disconnect(),this.startedTouchDrag=!1,1==t.touches.length)this.onPointerDownPointerX=t.changedTouches[0].clientX,this.onPointerDownPointerY=t.changedTouches[0].clientY,this.onPointerDownLon=this.lon,this.onPointerDownLat=this.lat,this.startedTouchDrag=!0;else if(2==t.touches.length){var e=new c.Vector2(t.touches[0].clientX,t.touches[0].clientY),i=new c.Vector2(t.touches[1].clientX,t.touches[1].clientY);this.touchDelta=e.distanceTo(i),this.touchCenter=e.lerp(i,.5),this.lastTouchDelta=this.touchDelta,this.lastTouchCenter=this.touchCenter}},onTouchMove:function(t){if(t&&t.preventDefault(),!this.cleanedUp&&!this.showCardboardEffect)if(1==t.touches.length&&this.startedTouchDrag){var e=.1*this.getZoomFactor();this.lonSpring.springTo(3*(this.onPointerDownPointerX-t.changedTouches[0].clientX)*e+this.onPointerDownLon),this.latSpring.springTo((t.changedTouches[0].clientY-this.onPointerDownPointerY)*e+this.onPointerDownLat)}else if(2==t.touches.length){var i=new c.Vector2(t.touches[0].clientX,t.touches[0].clientY),n=new c.Vector2(t.touches[1].clientX,t.touches[1].clientY),o=i.distanceTo(n);if(o!=this.touchDelta){this.lastTouchDelta=this.touchDelta,this.lastTouchCenter=this.touchCenter,this.touchDelta=o,this.touchCenter=i.lerp(n,.5);var s=this.lastTouchDelta-this.touchDelta;s=c.Math.clamp(s,-1.75,1.75),this.fov+=1*s,this.fovSpring.springTo(this.fov)}}},onTouchEnd:function(t){if(t&&t.preventDefault(),!this.cleanedUp&&!this.showCardboardEffect){var e=(new Date).getTime(),i=e-(this.lastTouchEnd?this.lastTouchEnd:e);if(1==t.changedTouches.length){var n=new c.Vector2(t.changedTouches[0].clientX,t.changedTouches[0].clientY),o=new c.Vector2(this.onPointerDownPointerX,this.onPointerDownPointerY),s=n.distanceTo(o);i<250&&i>30?this.onDblClick(t):s<3&&this.onClick(t)}this.lastTouchEnd=e}},removeAllAnnotations:function(){var t=Array.from(this.annotations);this.removeDeletedAnnotationsFromScene(t),this.annotations=[]},removeDeletedAnnotationsFromScene:function(t){for(var e=0;e<t.length;++e){(i=t[e]).mesh&&this.scene.remove(i.mesh),i.mesh=null,i.preview&&(i.preview.remove(),i.preview=null)}for(e=0;e<t.length;++e){var i=t[e],n=this.findAnnotationInScene(i.key),o=this.annotations.indexOf(n);this.annotations.splice(o,1)}},findAnnotationInScene:function(t){for(var e=0;e<this.annotations.length;++e)if(null!=this.annotations[e].key&&this.annotations[e].key==t)return this.annotations[e];return null},updateAnnotationsInScene:function(t){for(var e=this.annotationDisplayMode!=m.HIDDEN,i=0;i<t.length;++i){var n=t[i],o=this.findAnnotationInScene(n.key);o?(o.heading=n.heading,o.pitch=n.pitch,o.imageUrl=n.imageUrl,o.thumbnailUrl=n.thumbnailUrl,o.text=n.text,o.model=n.model,o.state=n.state,o.mesh?o.mesh.material=this.materialForAnnotation(o):(this.createMeshForAnnotation(o),o.mesh.visible=e)):(this.createMeshForAnnotation(n),n.mesh.visible=e,this.annotations.push(n))}var s=v.filter(this.annotations,(function(t){return null==t.key}));v.each(s,function(t){t.mesh&&(this.scene.remove(t.mesh),t.mesh=null)}.bind(this)),this.annotations=v.filter(this.annotations,(function(t){return null!=t.key})),this.annotations.sort((function(t,e){return t.key&&e.key?t.key.localeCompare(e.key):-1}))},handleAnnotationExportListRequest:function(t){this.showAnnotationListExportModal()},setAnnotationDisplayMode:function(t){this.annotationDisplayMode=t,this.annotationDisplayMode===m.HIDDEN?this.deselectAllAnnotationsForSidebar(!1):(this.annotationDisplayMode===m.MARKER_AND_UI||this.annotationDisplayMode===m.MARKER_ONLY)&&this.deselectAllAnnotationsForSidebar(!0)},handleIndexViewPopoverRequest:function(t){if(this.idxView)this.idxView.remove(),this.idxView=null;else{var e=this.annotationDisplayMode!==m.HIDDEN,i=new O({collection:this.annotationTargetCollection,annotationVisible:e,useCustomDataFields:this.useCustomDataFields,customData:this.options.customData});i.$el.appendTo(this.el),i.on(T,function(){this.playSlideshow?this.stopSlideshow():this.startSlideshow()}.bind(this)),i.on(b,function(){this.annotationDisplayMode!==m.HIDDEN?this.setAnnotationDisplayMode(m.HIDDEN):this.setAnnotationDisplayMode(m.MARKER_AND_UI)}.bind(this)),i.on(y,function(t){this.playSlideshow&&this.stopSlideshow(),this.jumpToAnnotationByKey(t.cid)}.bind(this)),this.idxView=i}},startSlideshow:function(){if(!(this.annotations.length<1)){this.shouldPan=!1,-1===this.currentTargetAnnotationIdx&&(this.currentTargetAnnotationIdx=0),this.jumpToAnnotation(this.currentTargetAnnotationIdx);var t=this,e=1e3*this.options.autoplayIntervalAnnotations;this.slideshowTimer=setInterval((function(){t.jumpToNextAnnotation()}),e),this.playSlideshow=!0}},stopSlideshow:function(){clearInterval(this.slideshowTimer),this.currentTargetAnnotationIdx=-1,this.playSlideshow=!1,this.idxView&&this.idxView.autoplayStopped()},jumpToNextAnnotation:function(){var t=this.currentTargetAnnotationIdx+1;t%=this.annotations.length,this.jumpToAnnotation(t)},jumpToAnnotation:function(t){this.currentTargetAnnotationIdx=t;var e=this.annotations[t];this.latSpring.springTo(e.pitch),this.lonSpring.springTo(e.heading),this.fovSpring.springTo(50),this.selectAnnotationForSidebar(e)},jumpToAnnotationByKey:function(t){this.shouldPan=!1;for(var e=-1,i=0;i<this.annotations.length;++i)if(null!=this.annotations[i].key&&t===this.annotations[i].key){e=i;break}-1!=e?this.jumpToAnnotation(e):console.log("Error, bad key")},createMeshForAnnotation:function(t){var e={lat:t.pitch,lon:t.heading},i=I(e).clone().multiplyScalar(475),n=this.markerDataForAnnotations(t),o=n.offset.clone().divide(new c.Vector2(512,512)),s=new c.Vector2(.5,.5),a=o.clone().sub(s).clone().clone().multiplyScalar(75),r=new c.Mesh(new c.PlaneGeometry(75,75),n.material);i.x+=a.x,i.y+=a.y;var l=S(i);i=I(l).clone().multiplyScalar(475),r.position.set(i.x,i.y,i.z);var h=i.clone().normalize().multiplyScalar(-1),d=new c.Vector3(0,1,0).clone().cross(h).normalize(),u=h.clone().cross(d).normalize(),p=new c.Matrix4;p.makeBasis(d,u,h),r.setRotationFromMatrix(p),t.mesh=r;var v=new c.BoxHelper(t.mesh,"green");t.bbox=v,this.scene.add(t.mesh)},computeHoverAnchor:function(t){var e=this.glContainer.getBoundingClientRect();return M(t.mesh,this.camera,e.width,e.height)},onDocumentMouseDown:function(t){t&&t.preventDefault(),this.cleanedUp||this.showCardboardEffect||(this.shouldPan=!1,this.stopSlideshow(),this.orientationControls.disconnect(),this.isUserInteracting=!0,this.onPointerDownPointerX=t.clientX,this.onPointerDownPointerY=t.clientY,this.onPointerDownLon=this.lon,this.onPointerDownLat=this.lat,this.trigger(G.events.SphereViewMouseDown))},onDocumentMouseMove:function(t){if(!this.cleanedUp){if(!0===this.isUserInteracting){var e=.1*this.getZoomFactor();this.lonSpring.springTo((this.onPointerDownPointerX-t.clientX)*e+this.onPointerDownLon),this.latSpring.springTo((t.clientY-this.onPointerDownPointerY)*e+this.onPointerDownLat)}if(this.annotationDisplayMode===m.MARKER_AND_UI){var i=this.hitTestAnnotation(t.clientX,t.clientY);this.updateAnnotationHoverStateForSidebar(i)}}},removeHoverStateOverlays:function(){v.each(this.annotations,function(t){t.preview&&(t.preview.remove(),t.preview=null)}.bind(this))},onDocumentDragOver:function(t){t&&(t.preventDefault(),t.dataTransfer.dropEffect="copy")},onDocumentMouseUp:function(t){this.stopInteracting()},onDocumentMouseOut:function(t){this.stopInteracting()},stopInteracting:function(){this.isUserInteracting=!1,this.cleanedUp||this.showCardboardEffect&&this.videoImage&&this.video.paused&&this.video.play()},updateCameraFromViewParameters:function(){orientCamera()},orientCamera:function(){this.fovSpring.update(),this.fov=c.Math.clamp(this.fov,this.minFov,this.maxFov);var t=c.Math.clamp(this.fovSpring.current.value,this.minFov,this.maxFov);this.camera.fov=t,this.camera.updateProjectionMatrix(),this.lonSpring.update(),this.latSpring.update();var e=this.lonSpring.current.value,i=this.latSpring.current.value;this.lon=e,this.lat=c.Math.clamp(i,-85,85),this.phi=c.Math.degToRad(90-this.lat),this.theta=c.Math.degToRad(this.lon),this.camera.target.x=500*Math.sin(this.phi)*Math.cos(this.theta),this.camera.target.y=500*Math.cos(this.phi),this.camera.target.z=500*Math.sin(this.phi)*Math.sin(this.theta),this.camera.lookAt(this.camera.target)},animate:function(){if(!this.cleanedUp){if(requestAnimationFrame(this.animate),this.timeDelta=this.clock.getDelta(),this.orientationControls.update(),0==this.orientationControls.enabled)if(this.shouldPan&&0!=this.options.panSpeed){var t=this.lonSpring.current.value,e=c.Math.radToDeg(this.timeDelta*this.options.panSpeed);this.lonSpring.resetTo(t-e),this.orientCamera()}else this.orientCamera();this.materialInitialized&&this.video&&this.videoImageContext&&this.videoTexture&&this.video.readyState>=this.video.HAVE_FUTURE_DATA&&(this.videoImageContext.drawImage(this.video,0,0),this.videoTexture.needsUpdate=!0),this.showCardboardEffect?this.effect.render(this.scene,this.camera):this.renderer.render(this.scene,this.camera)}}}),G.getFullscreenElement=function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement||null},G.isFullscreenMode=function(){return null!==G.getFullscreenElement()},G.requestFullScreen=function(){var t=document.body;t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()},G.exitFullScreen=function(){if(G.isFullscreenMode){var t=document;t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitExitFullscreen?t.webkitExitFullscreen():t.msExitFullscreen&&t.msExitFullscreen()}},G.isInPortraitOrientation=function(){return window.orientation%180==0},G.GridBreakpoints={xs:0,sm:544,md:768,lg:992,xl:1200},G.ScreenIsWiderThan=function(t){return(screen.width||n(document).width())>t},G.isMobile={Windows:function(){return/IEMobile/i.test(navigator.userAgent)},Android:function(){return/Android/i.test(navigator.userAgent)},BlackBerry:function(){return/BlackBerry/i.test(navigator.userAgent)},iOS:function(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)},any:function(){return G.isMobile.Windows()||G.isMobile.Android()||G.isMobile.BlackBerry()||G.isMobile.iOS()}},t.exports=G}).call(this,i(3),i(1))},817:function(t,e,i){var n=i(8).TIERS,o=i(168).EMBED_DISPLAY_MODE;function s(t){return t===n.PRO||t===n.BUSINESS}t.exports={isCleanDisplayModeAndPaid:function(t){var e=t.displayMode,i=t.tier;return e===o.CLEAN&&function(t){return t===n.PLUS||t===n.PRO||t===n.BUSINESS}(i)},isCleanDisplayModeAndPro:function(t){var e=t.displayMode,i=t.tier;return e===o.CLEAN&&s(i)},isCleanLogoDisplayModeAndPro:function(t){var e=t.displayMode,i=t.tier;return e===o.CLEAN_LOGO&&s(i)},isMlsDisplayModeAndPro:function(t){var e=t.displayMode,i=t.tier;return e===o.MLS&&s(i)},isMpDisplayMode:function(t){return t.displayMode===o.MP},canDisplayCustomDataFields:function(t){var e=t.tier;return function(t){return t===n.PRO}(e)||function(t){return t===n.BUSINESS}(e)}}}});
//# sourceMappingURL=sa.js.map